import{_ as ie}from"./index.vuevuetypescriptsetuptruelang-CXhdpZX4.js";import{_ as re}from"./index.vuevuetypestyleindex0lang-HDsWQUX7.js";import{_ as de}from"./index-BkhLq4fL.js";import{_ as X}from"./index.vuevuetypescriptsetuptruelang-O913YC12.js";import{_ as Z}from"./index-CS5NO12N.js";import{m as ee,u as ue,Q as ce,I as te,n as pe,w as me,U as fe,F as ye,e as ae,v as ve}from"./antd-Ca0Vg3PV.js";import{d as J,f,$ as k,a6 as j,a9 as w,u as e,ab as ge,m as _e,A as ke,k as i,D as oe,r as G,a8 as xe,Y as T,Z as o,ac as B,F as Q,G as R,H as M,c as we,a3 as D,a5 as be}from"./vue-BrVXbuSH.js";import{u as Ue}from"./request-L53qO1wJ.js";import{k as Re,h as se,u as Ce}from"./index-BKHAbEsV.js";import"./context-DBnFWosq.js";import"./plugin-vueexport-helper-DlAUqK2U.js";const Ve={class:"relative w-full h-full"},Ie=["controls","src"],ne=J({__name:"VideoPreview",props:{canPlay:{type:Boolean,default:!0},source:{},videoMaxHeight:{default:"max-h-308px"}},setup(y,{expose:g}){const c=f(!1),p=f();function x(s){y.canPlay&&(c.value=!s.target.paused)}function v(){y.canPlay&&p.value&&p.value.play()}function m(){var s;y.canPlay&&c.value&&((s=p.value)==null||s.pause())}return g({pauseVideo:m,playVideo:v}),(s,b)=>{const a=Z;return k(),j("div",Ve,[w("video",{id:"video",ref_key:"videoRef",ref:p,controls:e(c),class:ge(["h-full w-full bg-neutral-400",{[s.videoMaxHeight]:!0}]),src:s.source,onPlaying:x,onPause:x},null,42,Ie),_e(i(a,{name:"play-circle",width:"80px",class:"absolute top-50% left-50% translate-x-[-50%] translate-y-[-50%] cursor-pointer text-beige-600",onClick:v},null,512),[[ke,s.canPlay&&!e(c)]])])}}});function Se(){const y=f([]),g=f({total:0,pages:1,size:10,current:1,countRange:"0~0"});return{pagination:g,list:y,setResponseList:p=>{const{records:x,total:v,size:m,current:s,pages:b}=p;y.value=x??[];const a=(s-1)*m,L=y.value.length===0?"0~0":`${a+1} - ${a+y.value.length}`;g.value={total:v,size:m,current:s,pages:b,countRange:L}}}}const Te={records:[{id:1,createTime:"2024/08/23 13:27",createUser:1,updateTime:"2024/08/23 13:39",updateCount:3,updateUser:1,title:"測試",category:"NECK",description:"測試上傳影片",fileName:"【肩_肘】(標題)訓練(描述)斜方肌訓練，對象：肩頸痠痛.MOV",status:"PUBLISH",deleteTime:"2024/08/23",deleteUser:1,deleteUserName:"超級管理員",uploadDate:"2024/08/23",lastEditDate:"2024/08/23",lastEditor:"超級管理員",screenshot:"video/【肩_肘】(標題)訓練(描述)斜方肌訓練，對象：肩頸痠痛.jpg",categoryName:"頭頸",link:"video/【肩_肘】(標題)訓練(描述)斜方肌訓練，對象：肩頸痠痛.MOV"},{id:2,createTime:"2024/08/23 13:31",createUser:1,updateTime:"2024/09/02 12:36",updateCount:1,updateUser:1,title:"測試",category:"NECK",description:"測試上傳影片大小",fileName:"【複合】(標題)伸展(描述)胸肌合併軀幹旋轉，站姿，對象：圓肩或駝背.mov",status:"PUBLISH",deleteTime:null,deleteUser:null,deleteUserName:null,uploadDate:"2024/09/02",lastEditDate:"2024/09/02",lastEditor:"超級管理員",screenshot:"video/【複合】(標題)伸展(描述)胸肌合併軀幹旋轉，站姿，對象：圓肩或駝背.jpg",categoryName:"頭頸",link:"video/【複合】(標題)伸展(描述)胸肌合併軀幹旋轉，站姿，對象：圓肩或駝背.mov"},{id:3,createTime:"2024/08/23 13:40",createUser:1,updateCount:0,title:"測試",category:"CHEST_RIBS",description:"測試影片",fileName:"test.mov",status:"PUBLISH",deleteTime:null,deleteUser:null,deleteUserName:null,uploadDate:"2024/08/23",lastEditDate:"2024/08/23",lastEditor:"超級管理員",screenshot:"video/test.jpg",categoryName:"胸肋",link:"video/test.mov",updateUser:"",updateTime:""},{id:4,createTime:"2024/09/04 01:23",createUser:1,updateCount:0,title:"測試_下肢評估",category:"PELVIS",description:"下肢動作測試",fileName:"746682628.505563.mp4",status:"PUBLISH",deleteTime:null,deleteUser:null,deleteUserName:null,uploadDate:"2024/09/03",lastEditDate:"2024/09/04",lastEditor:"超級管理員",screenshot:"video/746682628.505563.jpg",categoryName:"髖/骨盆",link:"video/746682628.505563.mp4",updateUser:"",updateTime:""}],total:100,size:10,current:1,pages:20};function le(){const{setResponseList:y,list:g,pagination:c}=Se();return{getVideoList:async s=>{y(Te)},videoList:g,pagination:c,createVideo:async s=>({status:"success"}),updateVideo:async(s,b)=>({status:"success"}),updateVideoStatusByIds:async(s,b)=>({status:"success"})}}async function Le(y,g){return(await Ue(`/option/${y}`,g,{paramsSerializer:{indexes:null}})??[]).map(c=>{const p=ee(c);return p.label=c.name,p.value=c.key,p})}const Ee={class:"col-12 md:col-6"},Ne={class:"col-12 md:col-6"},De={class:"col-12"},he={class:"col-12"},Be=J({__name:"VideoFormModal",setup(y,{expose:g}){const{loading:c,onHideLoading:p,onLoading:x}=Re(),v=f([]),{createVideo:m,updateVideo:s}=le();async function b(){v.value=await Le("treatmentArea")}oe(()=>{b()});const a=f(!1),L=f(),C=f(!0),P={title:"",category:void 0,description:"",status:"PUBLISH",videoFile:void 0,link:""},n=G(ee(P)),$=G({title:[{message:"請輸入標題",required:!0,trigger:"blur"}],category:[{message:"請選擇分類",required:!0,trigger:"blur"}],description:[{message:"請輸入描述",required:!0,trigger:"blur"}],link:[{message:"請上傳影片",required:!0,trigger:"blur"}]}),V=se(),{validateInfos:E,validate:U,resetFields:F}=ue(n,$),A=xe();async function Y(){x();try{await U(),(C.value?await m(n):await s(n,L.value.id)).status==="success"&&(V.success({message:C.value?"新增影片成功":"編輯影片成功",placement:"top"}),A.push({name:"Video"})),p()}catch(u){p(),console.error(u)}}function h(u){a.value=!0,u?(C.value=!1,L.value=u,F({title:u.title,category:u.category,description:u.description,status:"PUBLISH",videoFile:void 0,link:u.link})):(C.value=!0,F(P))}const r=f(null);function t(u){const S=u.target.files;S.length>0&&r.value&&(n.videoFile=S[0],n.link=window.URL.createObjectURL(S[0]),r.value.value="")}const I=f();return g({show:h}),(u,d)=>{const S=te,N=pe,K=me,q=fe,l=Z,O=X,H=ye,z=ae;return k(),T(z,{open:e(a),"onUpdate:open":d[5]||(d[5]=_=>M(a)?a.value=_:null),title:e(C)?"新增影片":"編輯影片",centered:"","ok-text":"確定","cancel-text":"取消",width:"628px","ok-button-props":{class:"w-full",disabled:e(c)},"cancel-button-props":{class:"w-full"},"after-close":()=>{var _;(_=e(I))==null||_.pauseVideo()},onOk:Y},{default:o(()=>[i(H,{layout:"vertical",autocomplete:"off",class:"row g-4"},{default:o(()=>[w("div",Ee,[i(N,B(e(E).title,{label:"標題"}),{default:o(()=>[i(S,{value:e(n).title,"onUpdate:value":d[0]||(d[0]=_=>e(n).title=_),placeholder:"請輸入"},null,8,["value"])]),_:1},16)]),w("div",Ne,[i(N,B(e(E).category,{label:"分類"}),{default:o(()=>[i(K,{value:e(n).category,"onUpdate:value":d[1]||(d[1]=_=>e(n).category=_),options:e(v),placeholder:"請選擇"},null,8,["value","options"])]),_:1},16)]),w("div",De,[i(N,B(e(E).description,{label:"描述",extra:"50字以內"}),{default:o(()=>[i(q,{value:e(n).description,"onUpdate:value":d[2]||(d[2]=_=>e(n).description=_),placeholder:"請輸入",maxlength:50,rows:4},null,8,["value"])]),_:1},16)]),w("div",he,[i(N,B(e(E).link,{label:"影片"}),{default:o(()=>[e(ce)(e(n).link)?(k(),j(Q,{key:1},[w("input",{ref_key:"uploadVideo",ref:r,type:"file",accept:".mov,.mp4",class:"!hidden",onChange:t},null,544),i(O,{color:"secondary",size:"small",onClick:d[4]||(d[4]=_=>{var W;return(W=e(r))==null?void 0:W.click()})},{icon:o(()=>[i(l,{name:"upload"})]),default:o(()=>[d[7]||(d[7]=R(" 上傳 "))]),_:1})],64)):(k(),j(Q,{key:0},[i(ne,{ref_key:"videoRef",ref:I,source:e(n).link},null,8,["source"]),i(O,{color:"secondary",size:"small",onClick:d[3]||(d[3]=()=>{e(n).videoFile=void 0,e(n).link=""})},{icon:o(()=>[i(l,{name:"upload"})]),default:o(()=>[d[6]||(d[6]=R(" 重新上傳 "))]),_:1})],64))]),_:1},16)])]),_:1})]),_:1},8,["open","title","ok-button-props","after-close"])}}}),Pe={class:"flex justify-between px-2 items-center py-4 bg-neutral-200 rounded-.5 mb-4"},$e={class:"border border-green-100 rounded-1 mb-2"},Qe=J({__name:"index",setup(y){const{getVideoList:g,pagination:c,videoList:p,updateVideoStatusByIds:x}=le(),v=Ce(),m=f("list"),s=f({keyword:"",sort:"desc",orderBy:"createTime"}),b=[{value:"list",label:"影片清單"},{value:"del",label:"刪除清單"}],a=G({selectedRowKeys:[],selectedRows:[]});function L(){a.selectedRowKeys=[],a.selectedRows=[],n(1)}function C(r,t){console.log("selectedRowKeys changed: ",r,t),a.selectedRowKeys=r,a.selectedRows=t}const P=we(()=>e(m)==="list"?[{title:"截圖",dataIndex:"link",key:"link",width:"110px"},{title:"標題",dataIndex:"title",key:"title",width:"100px"},{title:"分類",dataIndex:"categoryName",key:"categoryName"},{title:"描述",dataIndex:"description",key:"description",width:"353px"},{title:"上傳日期",dataIndex:"createTime",defaultSortOrder:"descend",key:"createTime"},{title:"最後編輯日期",dataIndex:"lastEditDate",key:"lastEditDate"},{title:"最後編輯者",dataIndex:"lastEditor",key:"lastEditor"},{title:"編輯",dataIndex:"action",key:"action"}]:[{title:"截圖",dataIndex:"link",key:"link",width:"110px"},{title:"標題",dataIndex:"title",key:"title",width:"100px"},{title:"分類",dataIndex:"categoryName",key:"categoryName"},{title:"描述",dataIndex:"description",key:"description",width:"353px"},{title:"上傳日期",dataIndex:"createTime",defaultSortOrder:"descend",key:"createTime"},{title:"刪除日期",dataIndex:"updateTime",key:"updateTime"},{title:"刪除者",dataIndex:"deleteUserName",key:"deleteUserName"}]);oe(()=>n(1));async function n(r,t=10){const I={page:r,limit:t,...e(s),...m.value==="del"?{status:"DELETE"}:{status:"PUBLISH"}};await g(I)}const $=se(),V=f(!1);async function E(){const r=await x(a.selectedRowKeys,"DELETE");(r==null?void 0:r.status)==="success"&&($.success({message:"刪除影片成功",placement:"top"}),V.value=!1,a.selectedRowKeys=[],a.selectedRows=[],n(1))}const U=f(!1);async function F(){(await x(a.selectedRowKeys,"PUBLISH")).status==="success"&&($.success({message:"復原影片成功",placement:"top"}),U.value=!1,a.selectedRowKeys=[],a.selectedRows=[],n(1))}async function A(r,t){s.value=Object.assign(s.value,{sort:t,orderBy:r}),await n(1,c.value.size)}async function Y(r,t){await n(t!==c.value.size?1:r,t)}const h=f(null);return(r,t)=>{const I=Z,u=X,d=te,S=de,N=re,K=ae,q=ie;return k(),T(q,{title:"影片管理"},{extraContent:o(()=>[i(u,{color:"primary",onClick:t[0]||(t[0]=()=>{var l;(l=e(h))==null||l.show()})},{icon:o(()=>[i(I,{name:"plus",width:"16px"})]),default:o(()=>[t[9]||(t[9]=R(" 新增影片 "))]),_:1})]),default:o(()=>[w("div",Pe,[i(d,{value:e(s).keyword,"onUpdate:value":t[1]||(t[1]=l=>e(s).keyword=l),class:"w-320px",placeholder:"請輸入關鍵字",onChange:t[2]||(t[2]=l=>n(1))},{addonBefore:o(()=>[i(I,{name:"search"})]),_:1},8,["value"])]),w("div",$e,[e(v).isAdmin?(k(),T(S,{key:0,modelValue:e(m),"onUpdate:modelValue":t[3]||(t[3]=l=>M(m)?m.value=l:null),options:b,onChange:L},null,8,["modelValue"])):D("",!0)]),i(N,B({columns:e(P),"table-layout":"auto",scroll:{x:"max-content"},pagination:e(c),"data-source":e(p)},{...e(v).isAdmin&&{rowSelection:{selectedRowKeys:e(a).selectedRowKeys,onChange:C}}},{onChangeSort:A,onChangePagination:Y}),{extraStart:o(()=>[e(v).isAdmin&&e(m)==="list"?(k(),T(u,{key:0,color:"secondary",size:"small",class:"mb-2",disabled:e(a).selectedRowKeys.length===0,onClick:t[4]||(t[4]=l=>V.value=!0)},{default:o(()=>t[10]||(t[10]=[R(" 刪除 ")])),_:1},8,["disabled"])):D("",!0),e(v).isAdmin&&e(m)==="del"?(k(),T(u,{key:1,color:"secondary",size:"small",class:"mb-2",disabled:e(a).selectedRowKeys.length===0,onClick:t[5]||(t[5]=l=>U.value=!0)},{default:o(()=>t[11]||(t[11]=[R(" 復原 ")])),_:1},8,["disabled"])):D("",!0)]),extraEnd:o(()=>[i(u,{color:"secondary",size:"small",class:"mb-2",disabled:e(a).selectedRowKeys.length===0,onClick:t[6]||(t[6]=l=>U.value=!0)},{default:o(()=>t[12]||(t[12]=[R(" 復原 ")])),_:1},8,["disabled"])]),bodyCell:o(({column:l,record:O,text:H})=>[l.key==="updateTime"||l.key==="createTime"||l.key==="lastEditDate"?(k(),j(Q,{key:0},[R(be(e(ve)(H).format("YYYY/MM/DD")),1)],64)):D("",!0),l.key==="link"?(k(),T(ne,{key:1,source:H,"can-play":!1,"video-max-height":"max-h-45px"},null,8,["source"])):D("",!0),l.key==="action"?(k(),T(u,{key:2,color:"secondary",size:"small",onClick:()=>{var z;(z=e(h))==null||z.show(O)}},{default:o(()=>t[13]||(t[13]=[R(" 編輯 ")])),_:2},1032,["onClick"])):D("",!0)]),_:1},16,["columns","pagination","data-source"]),i(K,{open:e(V),"onUpdate:open":t[7]||(t[7]=l=>M(V)?V.value=l:null),title:"確定刪除影片？",centered:"","ok-text":"確定","cancel-text":"取消",onOk:E},{default:o(()=>t[14]||(t[14]=[w("div",{class:"text-center text-16 text-beige-900"}," 您選擇的影片將刪除。 ",-1)])),_:1},8,["open"]),i(K,{open:e(U),"onUpdate:open":t[8]||(t[8]=l=>M(U)?U.value=l:null),title:"確定復原影片？",centered:"","ok-text":"確定","cancel-text":"取消",onOk:F},{default:o(()=>t[15]||(t[15]=[w("div",{class:"text-center text-16 text-beige-900"}," 您選擇的影片將復原。 ",-1)])),_:1},8,["open"]),i(Be,{ref_key:"videoFormRef",ref:h},null,512)]),_:1})}}});export{Qe as default};
